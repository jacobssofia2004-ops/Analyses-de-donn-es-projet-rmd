---
title: "Projet d'analyse de données - Études sur les volcans méditerranéens"
author: |
  <em>Jacobs Sofia & Bauer Julie<br>
  Master STPE/MV – UCA<br>
  Année académique 2025-2026</em>
date: "<span style='float:right;'>25 septembre 2025</span>"
output: 
  html_document:
    toc: yes
    toc_float:  
      collapsed: false     
      smooth_scroll: true  
      position: right     
    number_sections: yes
    css: styles.css

---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,message = FALSE)
```

```{r}
df <- read.csv("DataR.csv", sep = ";")#importation des données
```
```{r include=FALSE}
packages <- c("dplyr", "ggplot2", "tidyr","performance","car","maps","ggspatial","sf", "prettymapr","rnaturalearth","rnaturalearthdata","viridis","see","patchwork","geosphere","reshape2","cowplot","factoextra","FactoMineR","plotly","PerformanceAnalytics","ade4","pheatmap","ggsci","nnet")

installed_packages <- rownames(installed.packages())
to_install <- packages[!(packages %in% installed_packages)]

if (length(to_install) > 0) {
  message("Installation des packages manquants : ", paste(to_install, collapse = ", "))
  install.packages(to_install)
}

invisible(lapply(packages, function(pkg) {
  library(pkg, character.only = TRUE)
  message("→ ", pkg, " chargé avec succès.")
}))

```
# Introduction 

Dans le monde, on compte plus de **800 millions** de personnes vivant à proximité d’un volcan dont **200 millions à moins de 30 km d’un volcan actif** (CNRS, 2025). La caractérisation de l’aléa volcanique est donc essentielle pour **la sureté des habitants** en territoires volcaniques. Cela passe notamment par la compréhension de lien divers entre un volcan et **le type de dépôts ou l’intensité éruptive** qu’il produit. Notre étude se concentre sur la région méditerranéenne, en particulier sur **deux édifices grecs** et **quatre édifices italiens**, ces deux pays étant particulièrement connues pour leurs volcanismes très actifs et notamment plusieurs éruptions historiques. 

```{r}
world <- ne_countries(scale = "medium", returnclass = "sf")

# Tracer la carte
ggplot(data = world) +
  geom_sf(fill = "antiquewhite") +
  geom_point(
    data = df,
    aes(x = Longitude, y = Latitude, color = Volcanoes),
    size = 2, alpha = 0.9
  ) +
  coord_sf(xlim = c(12, 30), ylim = c(35, 42), expand = FALSE) +
  theme_minimal() +
  labs(
    title = "Localisation des volcans en Italie du Sud et en Grèce",
    x = "Longitude",
    y = "Latitude",
    color = "Volcan"
  ) +
  theme(panel.background = element_rect(fill = "lightblue"),
        panel.grid = element_line(color = "white"))



```

Les volcans italiens sont **l’Etna (Sicile, Italie), le Vésuve (Naples, sud de l’Italie), Lipari et Vulcano (Iles Eoliennes, Sicile, Italie). Les volcans grecques sont le Santorin et le Nisyros (Iles Dodecanese, Grèce)**. Ici nous ne nous concentrerons que sur **la période 2015 à 2025**.

```{r}
volcanIt <- df[15:36,]

ggplot(data = world) +
  geom_sf(fill = "antiquewhite") +
  geom_point(
    data = volcanIt,
    aes(x = Longitude, y = Latitude, color = Volcanoes),
    size = 2, alpha = 0.9
  ) +
  coord_sf(xlim = c(12, 19), ylim = c(36.5, 41.5), expand = FALSE) +
  theme_minimal() +
  labs(
    title = "Localisation des volcans en Italie du Sud",
    x = "Longitude",
    y = "Latitude",
    color = "Volcan"
  ) +
  theme(panel.background = element_rect(fill = "lightblue"),
        panel.grid = element_line(color = "white"))

```

```{r}
volcanGr <- df[c(1:13,37:47),]
ggplot(data = world) +
  geom_sf(fill = "antiquewhite") +
  geom_point(
    data = volcanGr,
    aes(x = Longitude, y = Latitude, color = Volcanoes),
    size = 2, alpha = 0.9
  ) +
  coord_sf(xlim = c(19, 30), ylim = c(35.5, 39), expand = FALSE) +
  theme_minimal() +
  labs(
    title = "Localisation des volcans de l'Archipelle des Dodecanese",
    x = "Longitude",
    y = "Latitude",
    color = "Volcan"
  ) +
  theme(panel.background = element_rect(fill = "lightblue"),
        panel.grid = element_line(color = "white"))
```

Nous avons **les données de magnitudes, types de magma, profondeur du magma, le VEI, la classification et le volume estimé de produits** pour chaque édifice volcanique en plus des coordonnées des éruptions pour chaque édifices.
L’objectif est de comprendre si il existe un **lien entre intensité de l’éruption (magnitude) et l’édifice volcanique** afin de déterminer quelle population s’expose à un **risque** plus important. Il sera aussi particulièrement intéressant de regarder le **lien possible entre volcans et type de magma** car le risques lié à un volcan est en partie du au type de matériaux qu’il produit. Ces résultats pourrait également nous permettre de déterminer si **les populations** d’un volcan en particulier s’exposent à un **risque accrue**. Enfin, d’un point de vus purement recherche nous allons nous intéressé au **lien entre édifice et profondeur du magma** car c’est grâce à la détection du magma en profondeur que l’on peut **anticiper une éruption**. Egalement à **la profondeur en fonction du type de magma** mais cela nous permettra, au terme d’une étude pétrologique ultérieure de prédire des **temps de remonté du magma et des durées pré-éruptifs** afin **d’alerter la population** en cas d’éruption imminente si ce lien existe.

# Analyse exploiratoire des données 

## Chargement et préparation des données

Les données ont été chargée et modifier pour avoir les bons types de variables. De plus, le **summary** a déjà permis d'obtenir pour les variables numériques : **le maximum**, **le minimum**, **la moyenne** et **la médiane**. 

Au niveau des volcans, il est important de préciser que pour le Vesuve il n'y a qu'une **seule éruption** prise en compte dans cette étude. 

```{r include=FALSE}
df [,c(1,2,8,11,12,13,14)]<- lapply(df[,c(1,2,8,11,12,13,14)], as.factor)
df$Volume <- as.numeric(df$Volume)

```
| Variable            | Type          | Résumé / Statistiques principales |
|--------------------|---------------|----------------------------------|
| **Volcanoes**      | Catégorielle  | Santorin (13), Nisyros (11), Lipari (9), Vulcano (6), Etna (7), Vesuvio (1) |
| **Magnitude**      | Numérique     | Min: 1.2 – Max: 5.3 – Moy: 2.76 – Médiane: 2.3 |
| **Depth (km)**     | Numérique     | Min: 0.0 – Max: 225.4 – Moy: 27.57 – Médiane: 10.0 |
| **Volume (m³)**    | Numérique     | Min: 6.3×10⁴ – Max: 7.98×10⁸ – Moy: 5.01×10⁷ – Médiane: 7.98×10⁵ |
| **Latitude**       | Numérique     |- |
| **Longitude**      | Numérique     | - |
| **VEI**            | Catégorielle  | VEI 1: 24, VEI 2: 9, VEI 3: 13, VEI 4: 1 |
| **Classification** | Catégorielle  | Hawaïen/Strombolien (24), Strombolien/Vulcanien (9), Vulcanien (13), Vulcanien/Plinien (1) |
| **Mag.Type**       | Catégorielle  | MB (19), MA (14), ML (9), MB-MA (3), MBa (1), MR (1) |
| **Region**         | Catégorielle  | Dodecanese Islands (24), Sicily (22), Southern (1) |
| **Country**        | Catégorielle  | Greece (24), Italy (23) |

## Calcul des distances entre les volcans

```{r}

centres <- df %>%
  group_by(Volcanoes) %>%
  summarise(
    Longitude = mean(Longitude, na.rm = TRUE),
    Latitude = mean(Latitude, na.rm = TRUE)
  )
dist_matrix_group <- distm(centres[, c("Longitude", "Latitude")], fun = distHaversine) / 1000
rownames(dist_matrix_group) <- centres$Volcanoes
colnames(dist_matrix_group) <- centres$Volcanoes

dist_long <- melt(dist_matrix_group)
colnames(dist_long) <- c("Volcano1", "Volcano2", "Distance_km")
ggplot(dist_long, aes(x = Volcano1, y = Volcano2, fill = Distance_km)) +
  geom_tile() +
  scale_fill_gradient(low = "white", high = "red") +
  geom_text(aes(label = round(Distance_km, 1)), color = "black") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(title = "Distances entre groupes de volcans (km)", fill = "Distance (km)")
```


## Calcule des paramètres de dispersions

```{r include=FALSE}
calc_stats_by_group <- function(df, group_col = "Group", numeric_vars = NULL) {
  
  if (is.null(numeric_vars)) {
    numeric_vars <- names(df)[sapply(df, is.numeric)]
  }
  
  # Fonction interne pour calculer les statistiques
  compute_stats <- function(x) {
    list(
      Variance = var(x, na.rm = TRUE),
      Mean     = mean(x, na.rm = TRUE),
      Median   = median(x, na.rm = TRUE),
      Min      = min(x, na.rm = TRUE),
      Max      = max(x, na.rm = TRUE)
    )
  }
  
  # 1. Calcul global
  global_list <- lapply(df[numeric_vars], compute_stats)
  global_df <- do.call(rbind, lapply(names(global_list), function(v) {
    data.frame(
      Group = "Global",
      Variable = v,
      Variance = global_list[[v]]$Variance,
      Mean     = global_list[[v]]$Mean,
      Median   = global_list[[v]]$Median,
      Min      = global_list[[v]]$Min,
      Max      = global_list[[v]]$Max,
      stringsAsFactors = FALSE
    )
  }))
  
  # 2. Calcul par groupe
  groups <- unique(df[[group_col]])
  group_dfs <- lapply(groups, function(g) {
    sub_df <- df[df[[group_col]] == g, numeric_vars, drop = FALSE]
    res <- lapply(sub_df, compute_stats)
    do.call(rbind, lapply(names(res), function(v) {
      data.frame(
        Group = g,
        Variable = v,
        Variance = res[[v]]$Variance,
        Mean     = res[[v]]$Mean,
        Median   = res[[v]]$Median,
        Min      = res[[v]]$Min,
        Max      = res[[v]]$Max,
        stringsAsFactors = FALSE
      )
    }))
  })
  
  final <- rbind(global_df, do.call(rbind, group_dfs))
  rownames(final) <- NULL
  
  # Option : enlever la notation scientifique
  final[, c("Variance", "Mean", "Median", "Min", "Max")] <- 
    lapply(final[, c("Variance", "Mean", "Median", "Min", "Max")], 
           format, scientific = FALSE, digits = 6)
  
  return(final)
}

# Exemple d'appel :
calc_stats_by_group(df, group_col = "Volcanoes",
                    numeric_vars = c("Depth", "Magnitude", "Volume"))


```

En moyenne, **Lipari génère des magmas qui viennent de plus profond** et le **Santorin les plus superficiels***.
**Nisyros est le volcan avec le plus grand volume** de produit estimé en moyenne et **Vulcano emet le moins** sur une même période d'activité.
La **magnitude des éruptions est en moyenne plus importante pour Nisyros**. Cela est cohérent car la magnitude est directement reliée au volume emis, plus le volume est important plus la magnitude le sera, hors Nisyros à le volume moyen le plus important donc la magnitude moyenne la plus importante. **Cependant ce n'est pas Vulcano qui possède la plus faible moyenne des magnitudes mais l'Etna**. Cela peut s'expliquer par le faite que **l'Etna à plus érupter sur 2015-2025 par rapport à Vulcano pour un volume moyen de débris légèrement inférieur**. La moyenne des magnitudes de l'Etna pourra donc être légèrement plus faible que celle de Vulcano.

Les valeurs de variance pour le volume et la magnitude sont ccohérentes par rapport au jeu de donné mais pour la **profondeur**, celles-ci sont beaucoup trop grande, cela s'explique par la présence d'**outlier (7 point de donnée)** de valeur beaucoup trop importante ou encore bien trop faibe qui donnent une dispersion des mesures exagérée.

On remarque qur pour le **Vésuve nous n'avons qu'une seule éruption**. Ainsi, nous ne pouvons **pas calsuler de valeurs de dispersion** et la profondeurs, la magnitude et le volume moyen seront les valeurs des données de l'éruption.

| Groupe    | Variable   | Variance               | Moyenne       | Médiane     | Min       | Max          |
|-----------|------------|-----------------------|---------------|-------------|-----------|--------------|
| Global    | Depth      | 2683.43422            | 27.56902      | 10.00       | 0.00      | 225.420      |
| Global    | Magnitude  | 1.56159               | 2.75957       | 2.30        | 1.20      | 5.300        |
| Global    | Volume     | 1.5973504×10¹⁶        | 5.012363×10⁷  | 798104.93   | 63395.73  | 798104926.0  |
| Santorin  | Depth      | 23.21269              | 7.44615       | 10.00       | 0.00      | 17.600       |
| Santorin  | Magnitude  | 2.25859               | 2.87692       | 1.90        | 1.20      | 4.700        |
| Santorin  | Volume     | 4.908889×10¹⁵         | 5.338526×10⁷  | 317731.29   | 63395.73  | 2.00474893×10⁸ |
| Etna      | Depth      | 130.90810             | 19.41429      | 25.20       | 5.00      | 30.000       |
| Etna      | Magnitude  | 1.07333               | 2.00000       | 1.50        | 1.40      | 4.300        |
| Etna      | Volume     | 9.056722×10¹⁴         | 1.156326×10⁷  | 126491.11   | 100475.46 | 7.9810492×10⁷ |
| Vesuvio   | Depth      | NA                    | -             | -           | -         | -            |
| Vesuvio   | Magnitude  | NA                    | -             | -           | -         | -            |
| Vesuvio   | Volume     | NA                    | -             | -           | -         | -            |
| Vulcano   | Depth      | 10.43741              | 9.28700       | 9.15        | 5.20      | 14.722       |
| Vulcano   | Magnitude  | 1.36967               | 2.21667       | 2.00        | 1.20      | 4.400        |
| Vulcano   | Volume     | 1.6690856×10¹⁵        | 1.708496×10⁷  | 443170.11   | 63395.73  | 1.00475457×10⁸ |
| Lipari    | Depth      | 8245.75305            | 54.22689      | 8.80        | 5.00      | 225.420      |
| Lipari    | Magnitude  | 0.84000               | 2.90000       | 2.70        | 1.80      | 4.400        |
| Lipari    | Volume     | 1.902945×10¹⁵         | 2.354918×10⁷  | 23549175.68 | 252382.94 | 100475457.300|
| Nisyros   | Depth      | 3726.96190            | 47.16182      | 13.10        | 5.47      | 152.810     |
| Nisyros   | Magnitude  | 1.45855               | 3.33636       | 2.80	       | 1.90      | 5.300        |
| Nisyros   | Volume     | 5.7457176×10¹⁶        | 1.150703×10⁸  | 2523829.38	 | 317731.29 | 798104926.000|


```{r include=FALSE}
#à quoi ça sert (je ne sais pas), pas vraiment utile 
df_quant <- df[,c("Depth","Magnitude","Volume")]
apply(df_quant,2,sd)
apply(df_quant,2,sd)/apply(df_quant,2,mean)
```
| Variable   | Écart-type (sd)     | Coefficient de variation (CV) |
|------------|----------------------|-------------------------------|
| Depth      | 5.18×10¹            | 1.88                          |
| Magnitude  | 1.25                | 0.45                          |
| Volume     | 1.26×10⁸            | 2.52                          |


Les *volcans grecs porduisent une plus large gamme d'éruption de magnitudes différentes* que les volacans Italiens et se sont égalment eux qui produisent les *éruptions les plus intenses avec Lipari*. Cependant, il n'y pas de grande difference entre les différents paramètres de dispersion des les volcans.

# Graphiques des analyses univariés

## Analyse univariée de la profondeur

Pour **l'ensemble des volcans, hormis les 7 outliers visibles en rouge sur le boxplot, la répartition des pofondeurs sur l'hitogramme est symétique par rapport à une valeur centrale de 10 km**. La majorité de nos magmas* proviennet donc de **chambre localsiée entre 15 et 7 km** ce qui reste relativement **superficielle**.

```{r echo=FALSE, message=FALSE, warning=FALSE}

p <- ggplot(df, aes(x = "", y = Depth)) +
  geom_boxplot(outlier.shape = 16, outlier.color = "red", alpha = 0.7) +
  stat_summary(fun = mean, geom = "point", shape = 18, size = 3, color = "blue") +
  theme_minimal(base_size = 14) +
  scale_y_log10() +
  labs(
    title = "Distribution des profondeurs \npour l'ensemble des volcans",
    x = "",
    y = "Profondeur (log(km))"
  ) +
  theme(
    legend.position = "none",
    axis.title.y = element_text(size = 12, face = "plain", margin = margin(r = 5)),  
    plot.title = element_text(face = "bold", size = 12),
    plot.subtitle = element_text(size = 12)
  )


p1 <- ggplot(df, aes(x = Depth)) +
  geom_histogram(aes(y = ..density..),   
                 binwidth = 0.2, 
                 fill = "lightyellow", 
                 color = "black", 
                 alpha = 0.7) +
  geom_density(color = "red", linewidth = 1) +
  theme_minimal() +
  labs(
    title = "Histogramme de la profondeur 
des magmas",
    x = "Depth",
    y = "Densité"
  ) +
  theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 12))


p + p1 + plot_layout(widths = c(5, 5))
```

## Analyse univariée de la magnitude

Nous n'avons pasde **pas de valeur abérente**. On a une **réputation bimodale des données**. Une première partie des magnitudes se situe en dessous de **3**, ce sont les **valeurs de magnétudes faibles** et une seconde partie se trouve au-dessus de 3 avec des **valeurs dites fortes**.

```{r}
p2 <- ggplot(df, aes(x = Magnitude)) +
  geom_histogram(aes(y = ..density..),  
                 binwidth = 0.2,
                 fill = "lightgreen",
                 color = "black",
                 alpha = 0.7) +
  geom_density(color = "red", linewidth = 1) +  
  theme_minimal() +
  labs(title = "Histogramme de la magnitude 
des éruptions",
       x = "Magnitude",
       y = "Densité") +
  theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 12))

p3 <- ggplot(df, aes(x = "", y = Magnitude)) +
  geom_boxplot(outlier.shape = 16, outlier.color = "red", alpha = 0.7) +  
  stat_summary(fun = mean, geom = "point", shape = 18, size = 3, color = "blue") + 
  scale_fill_viridis(discrete = TRUE, option = "D") +  
  theme_minimal(base_size = 12) +
  scale_y_log10() +
  labs(
    title = "Distribution des magnitudes pour 
        l'ensemble des volcans",
    x = "",
    y = "Magnitude"
  ) +
  theme(
    legend.position = "none",
   axis.title.y = element_text(size = 12, face = "plain", margin = margin(r = 5)),   
    plot.title = element_text(face = "bold", size = 12),
    plot.subtitle = element_text(size = 12))

p3+p2+plot_layout(widths = c(1,1.5))
```
Les **fortes magnitudes ont une distribution sysmétrique** qui s'articule autour d'une **valeur centrale de 4,3** tandis que les **faibles magnitudes** suivent aussi une **distribution sysmétrique** autour de **1,8** mais reste moins marqué et s'étale dans **l'intervalle 1 à 2,2**.

```{r}
df_forte  <- df[df$Magnitude >= 3, ]
df_faible <- df[df$Magnitude < 3, ] 
```

```{r}
p4 <- ggplot(df_forte, aes(x = Magnitude)) +
  geom_histogram(aes(y = ..density..), binwidth = 0.2,
                 fill = "lightgreen", color = "black", alpha = 0.7) +
  geom_density(color = "red", linewidth = 1) +  # size -> linewidth
  theme_minimal() +
  labs(title = "Histogramme de la magnitude 
  des éruptions fortes (>=3)",
       x = "Magnitude", y = "Densité") +
  theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 14))

p5 <- ggplot(df_faible, aes(x = Magnitude)) +
  geom_histogram(aes(y = ..density..), binwidth = 0.2,
                 fill = "lightgreen", color = "black", alpha = 0.7) +
  geom_density(color = "red", linewidth = 1) +
  theme_minimal() +
  labs(title = "Histogramme de la magnitude 
  des éruptions faibles (<3)",
       x = "Magnitude", y = "Densité") +
  theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 14))

p5 + p4 + plot_layout(widths = c(1, 1))
```


## Analyse univariée du volume estimé

Pour les **volumes estimés**, on montrent également une **répartition bimodale tres similaire à celle des magnitudes** avec une valeur intermétidaiure entre les faibles et les forts volumes de **16,25 km3**. Les **forts volumes** s'articulent autour d'un mode de **18,7 km3** et la **faibles volumes** autoure de **12,5 km3** mais cela reste moins symétirque et forme plus un plateau. **Les volumes estimés sont utilisés pour déterminer la magnitude de l'érution, il est donc logique qu'il suivent excatement la meme distibution pour l'hitogramme et le boxplot**.

```{r}
p6 <- ggplot(df, aes(x = log(Volume))) +
  geom_histogram(aes(y = ..density..),   
                 binwidth = 0.2,
                 fill = "lightgreen",
                 color = "black",
                 alpha = 0.7) +
  geom_density(color = "red", linewidth = 1) +
  theme_minimal() +
  labs(title = "Histogramme des volumes estimés d'éruptions",
       x = "log(Volume érupté)",
       y = "Densité") +
  theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 12))


p7 <- ggplot(df, aes(x="", y = Volume)) +
  geom_boxplot(outlier.shape = 16, outlier.color = "red", alpha = 0.7) +  
  stat_summary(fun = mean, geom = "point", shape = 18, size = 3, color = "blue") + 
  scale_fill_viridis(discrete = TRUE, option = "D") +  
  theme_minimal(base_size = 14) +
  scale_y_log10() +
  labs(
    title = "Distribution des volumes 
estimés pour l'ensemble 
          des volcans",
    x = "",
    y = "Volume"
  ) +
  theme(
    legend.position = "none",
   axis.title.y = element_text(size = 12, face = "plain", margin = margin(r = 5)),    
    plot.title = element_text(face = "bold", size = 12),
    plot.subtitle = element_text(size = 12))
p7+p6+plot_layout(widths = c(1,2.5))
```

## Analyse univariée du type de magma

La majorité des magmas sont basaltique (MB) avec quelques occurences andésitique (MA) et latitique (ML=un magma latitique est un magma basaltique avec une texture particulière, il n'y a pas de différence de chimie importante). La série est basic et donc faiblement différencié. En effet il n'y a quaiment pas de magma différencié rhyolique (MR). La faible présence de basalte alcalin (MBa) révelle que les magmas générés appartiennen à la série subalcaline. Enfin, il se produit un petit peu de mélande car 3 magmas on uen composition intermédiaire entre basaltique et andésitique (MB-MA).

```{r}
ggplot(df,aes(x=Mag.Type))+
  geom_bar(fill="lightyellow", color="black", alpha=0.7)+
  theme_minimal()+
  labs(title="Répartition des types de magmas éruptés pour l'ensemble des volcans ",
       x="Type de magma",
       y="Nombre d'observation")+
  theme(plot.title = element_text(hjust = 0.5, face="bold", size=12))
```

## Analyse univariée du VEI estimé

Le VEI est une échelle de 1 à 8 donnant l'intensité d'une éruption volcanique (1 tres peu intense et 8 extremement intense). Dans la région, **la majorité des éruptions sont de faible intensité** avec un VEI autour de **1** et **2** (plus de 30 cas), **VEI 1 étant majoritaire**. On enregistre des éruption peu à moyennement intense (3 à 4), mais elles restent minoritaire. Il n'y a aucune éruption avec un VEI supérieure à 4, ce qui est rassurant puisque les grosses éruptions ont une occurences de plusieurs centaines d'année et sont donc difficilement visible sur une période de 10 ans.

```{r}
ggplot(df, aes(x = VEI.approximatif)) +
  geom_bar(fill = "lightyellow", color = "black", alpha = 0.7) + 
  theme_minimal() +
  labs(title = "Répartition des VEI pour l'ensemble des volcans",
       x = "VEI",
       y = "Nombre d'observations") +
  theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 12))

```

# Analyse bivariés

Cette analyse univarié a permis de déterminer l'allure de chacune des variables du jeu données. Il est a présent possible d'étudier des liens possibles entre ces différentes données.

## Lien entre deux variables quantitatives

### Lien entre la magnitude et la profondeur 

**5 outliers** sont visble ce qui confirme nos obeservation faites dans l'univariée avec des points de profondeur beaucoup trop importante.
Il n'y a **aucune corélation visible entre la profondeur et la magnétude**.
Nous allons quand même effectuer un test pour vérifeir notre hypothèse. Il n'est pas possible de faire une ANOVA car nous avons de variables quantitatives et l'ANOVA compare deux moyennes de deux goupres, hors ici nous cherchons à corréler deux varables. Nous effectuons donc un **test de corrélation**.

```{r}

ggplot(df) +  geom_point(aes(x = Magnitude, y = Depth), size = 1) +
  labs(
    title = "Distribution de la magnitude des volcans en fonction de la profondeur du magma",
    x = "Magnitude",
    y = "Profondeur (km)"
  ) +
  theme_minimal ()


```


```{r}
co <- cor(df$Magnitude, df$Depth, method = "spearman")#pas de corrélation entre les deux variables 
```

Un test de **corrélation de Spearman** est choisit car les données ne sont pas distribuées normalement (voir histogramme). Il s'agit d'un test qui est dit non paramétrique. Ce ne sont pas les données en tant que telle qui sont utilisées mais leurs rangs.

Le **coefficient de corrélation** est de  **`r co[1] `**  . C'est une corrélation positive mais la valuer reste **faible** car comprise entre 0.1 et 0.3 à plus ou moins 0.02, on a donc une **faible corrélation entre la profondeur et la magnitude**.

### Lien entre magnitude et le volume estimé


```{r}

ggplot(df) +  geom_point(aes(x = Magnitude, y = log(Volume)), size = 1) +
  labs(
    title = "Distribution des volumes estimés des volcans en fonction de la magnitude",
    x = "Magnitude",
    y = "Volume"
  ) +
  theme_minimal ()
res <- lm(log(Volume)~Magnitude,data=df)

```

```{r}
par(mfrow = c(2,2))
plot(res)
par(mfrow = c(1,1))
```

On observe une **corrélation positive entre la magnitude et le volume estimé**. En effet, plus la magnitude est importante plus le volume estimé l'est également. Le modèle linéaire confirme cette observation avec un **$R^2$ de 1** ce qui est très élevé. Cependant, il existe une **realtion théorique entre volume estimé et magnitude**. La magnitude est calculer à parit du volume estimée sur le terrain. Ils sont donc mathéatiquement reléi l'un à l'autre et cette correlétion poistive ne reflete en rien un lien naturel entre les deux varibale mais traduits une simple équation mathématiques.

### Lien entre le volume et la profondeur 



```{r}
ggplot(df) +  geom_point(aes(x = log(Volume), y = Depth), size = 1) +
  labs(
    title = "Evolution de la profondeur en fonction du volume estimé des volcans",
    x = "Log(Volume)",
    y = "Profondeur"
  ) +
  theme_minimal ()
```
 
```{r}
co.1 <- cor(log(df$Volume), df$Depth, method = "spearman")
```

Une relation peut également être étudiée entre le volume estimé et la profondeur. Cependant, étant donné que le volume a été estimé à partir de la magnitude, les deux graphiques montrent exactement les mêmes tendances. **Cette similitude se remarque également au niveau de la valeur du coefficient de corrélation de Spearman qui vaut r `co.1[1]`.**

## Lien entre variable qualitative et quantitative

### Magnitude en fonction des volcans

On remarque à nouveau que pour le Vésuve, on ne peut interpréter car on a qu'une seule varleur.
Plusieurs remarques sont possibles. Tout d'abords, les **magnitudes par volcans sont dépendantes**, sinon l'ensembles des médianes seraient alignées. 

De plus, **la médiane et la moyenne ne coincident pas**, ce qui témoignent d'une **asymétries des distributions**.

Dans certains cas, les **courbes de densité** montrent également des **bimodalités** visibles. 

Il est possible d'observer que **certains groupes ont des distributions bimodal et non pas juste normal**. 



```{r message=FALSE, warning=FALSE}
p1 <- ggplot(df, aes(x = Volcanoes, y = Magnitude, color = Volcanoes)) +
  geom_boxplot(alpha = 0, width = 0.4, outlier.shape = NA) +
  stat_summary(fun = mean, geom = "point", shape = 20, size = 4) +
  theme_minimal(base_size = 14) +
  theme(
    legend.position = "none",
    axis.title.x = element_blank(),
    axis.text.x = element_text(angle = 25, hjust = 1),
    plot.title = element_text(face = "bold")
  ) +
  ggtitle("Boxplot")


p2 <- ggplot(df, aes(x = Volcanoes, y = Magnitude, color = Volcanoes)) +
  geom_jitter(position = position_jitter(width = 0.15, height = 0), alpha = 0.5, size = 2) +
  stat_summary(fun.data = mean_cl_normal, geom = "pointrange", size = 0.6) +
  theme_minimal(base_size = 14) +
  theme(
    legend.position = "none",
    axis.title.x = element_blank(),
    axis.text.x = element_text(angle = 25, hjust = 1),
    plot.title = element_text(face = "bold")
  ) +
  ggtitle("Dot")


p3 <- ggplot(df, aes(x = Magnitude, fill = Volcanoes)) +
  geom_density(alpha = 0.4, color = "black", linewidth = 0.3) +
  theme_minimal(base_size = 14) +
  theme(
    legend.position = "none",
    plot.title = element_text(face = "bold")
  ) +
  ggtitle("Density")


plot_grid(p1, p2, p3, nrow = 1, rel_widths = c(1, 1, 1.1))
```

Si on veut observer une différence entre les volcans par rapport à la magnitude, on effectuer un **test non-paramétrique**. Un ANOVA ne fonctionnerait pas ici car nous n'avons une répartition normale de nos donnée de magnitude.

Il serait intéressant de savoir si il y a bien une différence significative entre ces différents volcans par rapport à la magnitude. Pour cela, le t.test ne fonctionne pas car celui-ci est pour des échantillons avec deux catégories dans cette étude, il y a six volcans différents. C'est donc une **ANOVA** qui va être réalisée. 

L'ANOVA (Analysis of Variance) permet de comparer les moyennes de plusieurs groupes pour déterminer s'il existe des différences significatives entre elles. Cependant, pour que les **résultats de l'ANOVA soient valides**, certaines **conditions** doivent être remplies :
1. **Indépendance des observations **: Les données de chaque groupe doivent être indépendantes les unes des autres. 
2. **Normalité** : La distribution des résidus (différences entre les valeurs observées et les valeurs prédites) doit suivre une distribution normale.
3.** Homogénéité des variances** : Les variances des différents groupes doivent être similaires (homoscédasticité).

```{r}
aov1 <- aov(Magnitude ~ Volcanoes, data = df)
opar <- par(mfrow = c(2, 2))
plot(aov1)
par(opar)
```



```{r}
leveneTest(Magnitude ~ Volcanoes, data = df)#pas significatif donc cela veut dire que les variances ne sont pas hétéroscédastique, ce qui est étrange au vu du graphique précédent. Les résidus dévient également légèrement de la normalité
```

Pas significatif donc cela veut dire que les variances ne sont pas hétéroscédastique, ce qui est étrange au vu du graphique précédent. Les résidus dévient également légèrement de la normalité

```{r}
summary (aov1)
```
Le summary de l'ANOVA, donne une valeur de **p-value de 0.264**. Celle-ci n'est **pas significative** (p-value > 0.05), il n'y a donc **pas de différence significative entre les volcans et les magnitudes**.


### Magnitude en fonction du type de magma

Le lien entre la magnitude et le type de magma peut également être étudié. 
==> Pour **MBa** et **MR**, il n'y a qu'**une seule valeur de magnitude**
==> **Ma** présente les **magnitudes les plus élevées**
==> **MB, MB-MA, ML** ont des **magnitudes plus similaire** entre elles

Au niveau du graphique de densité, il est possible de voir que : 
==> **MA** présente une **distribution binomiale** mais la plupart de l'information se trouve quand même entre **4 et 5 au niveau des magnitudes**
 
==> **MBa,MB,ML la distribution est bi-nomiale**


```{r message=FALSE, warning=FALSE}
p1 <- ggplot(df, aes(x = Mag.Type, y = Magnitude, color = Mag.Type)) +
  geom_boxplot(alpha = 0, width = 0.4, outlier.shape = NA) +
  stat_summary(fun = mean, geom = "point", shape = 20, size = 4) +
  theme_minimal(base_size = 14) +
  theme(
    legend.position = "none",
    axis.title.x = element_blank(),
    axis.text.x = element_text(angle = 25, hjust = 1),
    plot.title = element_text(face = "bold")
  ) +
  ggtitle("Boxplot")


p2 <- ggplot(df, aes(x = Mag.Type, y = Magnitude, color = Mag.Type)) +
  geom_jitter(position = position_jitter(width = 0.15, height = 0), alpha = 0.5, size = 2) +
  stat_summary(fun.data = mean_cl_normal, geom = "pointrange", size = 0.6) +
  theme_minimal(base_size = 14) +
  theme(
    legend.position = "none",
    axis.title.x = element_blank(),
    axis.text.x = element_text(angle = 25, hjust = 1),
    plot.title = element_text(face = "bold")
  ) +
  ggtitle("Dot")


p3 <- ggplot(df, aes(x = Magnitude, fill = Mag.Type)) +
  geom_density(alpha = 0.4, color = "black", linewidth = 0.3) +
  theme_minimal(base_size = 14) +
  theme(
    legend.position = "none",
    plot.title = element_text(face = "bold")
  ) +
  ggtitle("Density")


plot_grid(p1, p2, p3, nrow = 1, rel_widths = c(1, 1, 1.1))
```

L'ANOVA doit ainsi respecter différents critères. Dans ce cas-ci : 
  L'**homoscédadasticité est respectée**, il est possible de voir que la ligne rouge sur le graphique est presque à l'horizontale 
  La **normalité des résidus est globalement respectée**. Cependant, certaines valeurs sont fortement éloignées de la droite centrale comme le 20 et le 42. 
  Au niveau du quatrième graphique, l'ensemble des donnée située dans les bornes de la distance cook. Cependant, les valeurs 20, 40 et 42 sont tout de même proche de ces extrémités. Cela peut causer un **effet de levier**.
  
```{r}
anova_magma <- aov(Magnitude ~ Mag.Type, data = df)
opar <- par(mfrow = c(2, 2))
plot(anova_magma)
par(opar)
```

```{r}
leveneTest(Magnitude ~ Mag.Type, data = df)#présence d'outlier au niveau de la normalité des résidus sinon au niveau des autres graphiques cela semble respecté les conditions de l'anova sont respectée
```

L'ANOVA est ainsi réalisée, et celle-ci donne une **valeur significative** (p-valeur<0.05). Il y a ainsi **une différences entre les différents types de magmas au niveau de la magnitude**.


```{r}
summary (anova_magma)#significatif donc il y a bien une différence entre les moyennes des magnitudes des différents types de magma
```

### Profondeur en fonction des volcans


```{r}
p1 <- ggplot(df, aes(x = Classification, y = Depth, color = Classification)) +
  geom_boxplot(alpha = 0, width = 0.4, outlier.shape = NA) +
  stat_summary(fun = mean, geom = "point", shape = 20, size = 4) +
  theme_minimal(base_size = 14) +
  theme(
    legend.position = "none",
    axis.title.x = element_blank(),
    axis.text.x = element_text(angle = 25, hjust = 1),
    plot.title = element_text(face = "bold")
  ) +
  ggtitle("Boxplot")


p2 <- ggplot(df, aes(x = Classification, y = Depth, color = Classification)) +
  geom_jitter(position = position_jitter(width = 0.15, height = 0), alpha = 0.5, size = 2) +
  stat_summary(fun.data = mean_cl_normal, geom = "pointrange", size = 0.6) +
  theme_minimal(base_size = 14) +
  theme(
    legend.position = "none",
    axis.title.x = element_blank(),
    axis.text.x = element_text(angle = 25, hjust = 1),
    plot.title = element_text(face = "bold")
  ) +
  ggtitle("Dot")


p3 <- ggplot(df, aes(x = Depth, fill = Classification)) +
  geom_density(alpha = 0.4, color = "black", linewidth = 0.3) +
  theme_minimal(base_size = 14) +
  theme(
    legend.position = "none",
    plot.title = element_text(face = "bold")
  ) +
  ggtitle("Density")


plot_grid(p1, p2, p3, nrow = 1, rel_widths = c(1, 1, 1.1))
```
**Il n'est pas possible d'observer une différence entre les différents types de magma.**
```{r}
anova_clas <- aov(Depth ~ Classification, data = df)
opar <- par(mfrow = c(2, 2))
plot(anova_clas)
par(opar)
```


```{r}
leveneTest(Depth~ Classification, data = df)
```

Les **conditions de l'anova ne sont pas respectées**, les résidus ne sont pas normalement distribués. Certaines des valerus atteignes presque la Cook distance. 
Il n'est ainsi pas possible de réaliser l'anova mais il est possible de réaliser un autre test qui lui est non paramétriques. Il s'agit du **test Kruskall-walis**.

```{r}
kruskal.test(Depth ~ Classification, data = df)
```

Le test de **kruskal-wallis est signifcatif**. Il faut préciser est sensible au différence de distributions donc si celles-ci sont fortement différentes comme c'est le cas ici il est **possible qu'il n'y est pas uniquement une différence au niveau des médianes**.



## Lien entre deux variables qualitatives

Dans cette partie de cette étude, c'est le lien entre les variables qualitatives qui va être étudié. 

### Répartition du VEI en fonction des volcans

Il est interessant d'analyser si il y a un lien entre le VEI et les volcans. Pour cela, on va réaliser un graphique de répartition du VEI en fonction des volcans. Il est possible d'observer que la majorité des éruptions ont un VEI compris entre 1 et 3. Nisyros est celui qui présente le VEI le plus haut. 

Un autre point important qu'il faut soulever c'est que la plupart des volcans ont un VEI faible, entre 1 et 2 en majorité. 
```{r}
ggplot (df, aes (x=VEI.approximatif)) +geom_bar (aes(fill = Volcanoes),position = "dodge")+
  labs(
    title = "Répartition des VEI en fonction des volcans",
    x = "VEI",
    y = "Nombre d'observations"
  ) +
  theme_minimal ()

```
Un test peut être réalisé afin de savoir si il y a un lien entre le VEI et les différents types de volcans. Il s'agit d'un **test de Chi2**. Pour pouvoir faire cela, il faut d'abord réaliser un **tableau de contingence**. 

```{r}
tabVEI <- table (df$VEI.approximatif,df$Volcanoes)
chisq.test(tabVEI)

```
Il s'agit d'un khi-deux pour **tester l'indépendance entre deux variables qualitatives**. 
Les hépytohèses : 
**H0 : il n'y a pas** de relation entre le VEI et les différents volcans.
**H1 : il y a **une relation entre le VEI et les différents volcans.

Dans ce cas-ci, le **test du chi 2 est significatif** car p-valeur > 0.05. Cela veut dire qu'**il n'y a pas de relation significatif entre le VEI et les volcans**.

### Répartition du type de magma en fonction des volcans

Il est possible de voir que MA et MB sont les types de magmas les plus fréquents. 
```{r}
ggplot (df, aes (x=Mag.Type)) +geom_bar (aes(fill = Volcanoes),position = "dodge")+
  labs(
    title = "Répartition des Type de magma en fonction des volcans",
    x = "Type de magma",
    y = "Nombre d'observations"
  ) +
  theme_minimal ()

```


```{r}
tab <- table(df$Volcanoes, df$Mag.Type)
tab
chisq.test(tab)
#signifcatif car p-valeur <0.05
```
### ACF
Une ACF est une analyse factorielle des correspondances. Cela  permet d'**analyser la relation entre deux variables qualitatives**. Il est ainsi important qu'il est la **présence d'une relation entre les deux**. C'est pour cela que l'AFC est réalisé à partir des **variables Volcanoes et Mag.Type**. 

Le but de l'AFC est de réduire la dimensionnalité des données tout en gardant l'écart d'indépendance entre les variables. 

Afin de pouvoir savoir le **nombres d'axes** qu'il faut retenir, un **scree plot** est réalisé. Celui-ci permet d'observer que ce sont bien les **deux premiers axes qui contiennent toute l'information** (~99%).

```{r}
res.ca <- CA(tab, graph = FALSE)

fviz_screeplot(res.ca, addlabels = TRUE)

```
Il est également intéressant de regarder quelles variables contribuents le plus à quels axes. 
Pour la première dimension :

- Les volcans qui contribuent le plus sont Nisyros, Santorin et Lipari

- Les types de magmas qui contribuent le plus sont MA et MB

Pour la deuxième dimension  

- Les volcans qui contribuent le plus sont Nisyros et Santorin

- Les types de magmas qui contribuent le plus sont MB-MA et ML


```{r}

fviz_contrib(res.ca, choice = "row", axes = 1)
fviz_contrib(res.ca, choice = "col", axes = 1)
fviz_contrib(res.ca, choice = "row", axes = 2)
fviz_contrib(res.ca, choice = "col", axes = 2)

```
Le biplot permet de visualiser les relations entre les modalités des deux variables. Il montre :

- les variables situées à droite sont principalement bien représentées. 

- Ma et Vesuvio, elles ont une qualité de représentation plus faible. Ce qui correspond bien avec les graphiques précédent qui montraient que Ma et le Vesuve n'était pas dans les variables les plus représentées dans les deux premières dimensions. 

- une discrimination forte entre les volcans italiens et les volcans égéens principalement expliquée par Dim1

- une discrimination entre Nisyros et Santorin principalement expliquée par Dim 2

- les volcans italiens présentent des caractéristiques communes, peu de dispersion

- les volcans grecs présentent une variabilité géochimique plus importantes. 



```{r}
fviz_ca_biplot(
  res.ca,
  label = "all",
  repel = TRUE,
  col.row = "cos2",
  col.col = "cos2",
  gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),
)


```


### Répartition du type de magma en fonction des classifications

- Le type MA est majoritaire dans la classification des volcans explosifs

- Le type MB est majoritaire dans la classification des volcans effusifs

- ML apparait uniquement dans la classification des volcans explosifs

- MB-MA et MR ne sont pas fortement représentés

```{r}
ggplot (df, aes (x=Classification)) +geom_bar (aes(fill = Mag.Type), position = "dodge")+
  labs(
    title = "Répartition des types de magma en fonction des classifications",
    x = "Classification",
    y = "Nombre d'observations"
  ) +
  theme_minimal ()
```
Le test chi2 est également réalisé pour savoir s'il y a une relation entre les deux variables qualitatives. Comme pour la relation précédente, la p-valeur <0.05. Ce qui veut dire qu'il y a bien une relation entre les deux variables. 
```{r}
tabmg <- table(df$Classification, df$Mag.Type)
chisq.test(tabmg)

```
### AFC
L'AFC est réalisée à partir des variables Classification et Mag.Type. Un scree plot est réalisé afin de savoir quelle composante principale prend en charge le plus de variabilité. Les deux premières composantes prennent 100% de la variabilité. 

```{r}
res.ca2 <- CA(tabmg, graph = FALSE)
fviz_screeplot(res.ca2, addlabels = TRUE)
```
Pour la première dimension : 

- La classification qui contribuent le plus sont Vulcanien 
- Le type de magmas qui contribuent est MA

Pour la deuxième dimension : 

- Les classifications qui contribuent le plus sont Strombolien/Vulcanien et Hawaiien/Strombolien 
- Les types de magmas qui contribuent le plus sont MB-MA, ML, MR
```{r}

fviz_contrib(res.ca2, choice = "row", axes = 1)
fviz_contrib(res.ca2, choice = "col", axes = 1)
fviz_contrib(res.ca2, choice = "row", axes = 2)
fviz_contrib(res.ca2, choice = "col", axes = 2)
```
Le biplot permet de visualiser les relations entre les modalités des deux variables.I Il montre :

- l'ensemble des variables sont bien représentées sauf Vulcanien/Plinien qui a un cos 2 inférieur à 0.9975. 

- Séparation nette entre la classification des volcans plus et moins exploisifs (Dim 1)

- MA est associée aux volcans plus explosifs (Vulcanien)

- Séparation au niveau des types Strombolien/Vulcanien et Hawaien/Strombolien (Dim 2) 

- MB-MA, ML, MR et MBa sont associés aux volcans moins explosifs (Hawaien/Strombolien)

```{r}
fviz_ca_biplot(
  res.ca2,
  label = "all",
  repel = TRUE,
  col.row = "cos2",
  col.col = "cos2",
  gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),
)


```

# Analyse multivariée 

Précédement, ce sont les analyses avec une pour deux variables qui était étudié. Il est pourtant également d'étudier les relations entre plus de trois variables différentes. 

## Représentation graphiques 
### Répartition du type de magma selon le volcan et la classification

Le graphique montre la répartition des types de magmas en fonction du volcans, des laves ainsi que la classification. Ce graphique permet d'observer : 

- Ma est le type de magma le plus fréquent que nivau de la classification Vulcanien au niveau des différents volcans 

- Nysiros est le seul volcan qui présente un comportement de type Vulcanien/Plinien 

- les types d'éruption les plus fréquent sont Hawaien/Strombolien et Vulcanien. 

- ML (magma latitique) n'apparait que dans la classificition Hawaien/Strombalien et au niveau de Santorin et un peu Nisyros.

```{r}
ggplot(df, aes(x = Volcanoes, fill = Mag.Type)) +
  geom_bar(position = "dodge") +
  facet_wrap(~ Classification) +
  theme_minimal() +
  labs(
    x = "Volcan",
    y = "Nombre d’échantillons",
    fill = "Type de magma",
    title = "Répartition du type de magma selon le volcan et la classification"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

## ACM

L'ACM est une analyse en composantes multiples. Celle-ci permet d'analyser les relations entre plusieurs variables qualitatives. Ici, l'ACM est réalisée à partir des variables Classification, Mag.Type, Volcanoes.

```{r}
acm_data <- df[, c("Classification", "Mag.Type", "Volcanoes")]
res.mca <- MCA(acm_data, graph = FALSE)
```

Le sreeplot permet d'observer qu'il faut 10 composantes principales pour expliquer 100% de la variance. 

```{r}
fviz_screeplot(res.mca, addlabels = TRUE)
```

```{r}
fviz_contrib(res.mca, choice = "var", axes = 1)
fviz_contrib(res.mca, choice = "var", axes = 2)

```

Un biplot peut également être réaliser pour l'ACM. Avant toute chose, il est interessant de regarder que l'échelle au niveau du cos2 n'est pas du tout la même que précédement. Les valeurs ici sont beaucoup plus faible. 



```{r}
fviz_mca_var(
  res.mca,
  repel = TRUE,
  col.var = "cos2" , gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"))

```

### Répartition de la magnitude en fonction de la profondeur et des volcans

 
```{r}
ggplot(df) +  geom_point(aes(x = Magnitude, y = Depth, color = Volcanoes), size = 1.5) +
  labs(
    title = "Distribution de la magnitude des volcans en fonction de la profondeur du magma",
    x = "Magnitude",
    y = "Profondeur (km)"
  ) +
  theme_minimal ()

```



## ACP 

L'ACP est une analyse en composantes principales. Celle-ci permet d'analyser les relations entre plusieurs variables quantitatives. Ici, l'ACP est réalisée à partir des variables Depth, Magnitude et Volume. 

Une matrice de corrélation est réalisée afin d'observer les relations entre les différentes variables quantitatives. Il est possible d'observer comme précédement qu'une forte corrélation positive exciste entre la magntiude et le volume car celui-ci est calculé à partir de la magnitude. En ce qui concerne le lien entre la profondeur et la magnitude, la corrélation est moins importante mais tout de même précente. 

```{r}
df_acp <- df[, c("Depth", "Magnitude", "Volume","Volcanoes")]
df_num <- df_acp %>%
  select(where(is.numeric))
chart.Correlation(df_num)
```

Il y a trois variables, il y a ainsi trois composantes principales. Le scree plot permet d'observer que les deux premières composantes gardent 89,6% de la variabilité totale. 


```{r}
acp_sect <- dudi.pca(df_num, scannf = FALSE, nf = ncol(df_acp))
fviz_screeplot(acp_sect, addlabels = TRUE)
```
Le graphique de contribution permet d'observer quelles variables contribuent le plus à chaque axe : 
- Les variables Magntiude et Volume contribuent fortement à la première dimension 
- La profondeur contribue plus à la deuxième. 
```{r}
pheatmap(as.matrix(acp_sect$co^2), cluster_cols=F,color = rev (hcl.colors(50, "Greens")))
```

```{r}
fviz_pca_var(acp_sect, col.var = "cos2", gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),labelsize = 3)
```

```{r}
fviz_pca_biplot(acp_sect,
                geom.ind = "point",
                geom.ind.params = list(size = 2),
                col.ind = df_acp$Volcanoes,
                fill.ind = df_acp$Volcanoes,
                palette = "jco",
                pointshape = 21,
                alpha.ind = 1,    
                repel = TRUE,
                legend.title = "Volcan",
                title = "ACP : Biplot avec points de taille fixe")


```


# Equation logistique multinomiale

La régression logistique multinomiale est une extension de la régression logistique binaire qui permet de modéliser des variables dépendantes catégorielles avec plus de deux catégories. Ici, deux modèles sont réalisés : un avec comme variable dépendante le type de magma et un autre avec comme variable dépendante le volcan.
```{r}
model <- multinom(Mag.Type ~ Magnitude , data = df)
model1 <- multinom(Mag.Type ~ Magnitude + Volume, data = df)
model2 <- multinom(Mag.Type ~ Magnitude + Volume + Depth, data = df)
```


```{r}
summary(model)
```

```{r}
summary(model1) 
```

```{r}
summary(model2)
```

L’AIC (Akaike Information Criterion) est une mesure qui permet de déterminer quel modèle statistique explique le plus le modèle. Il faut que l’AIC soit la plus faible possible. Le plus grand point fort de l’AIC, c’est qu’elle pénalise les modèles qui sont trop complexes et qui donc ne peuvent pas s’appliquer sur des données invisibles. 

Dans cette étude, c'est le deuxième qui est le meilleur car il a l'AIC la plus faible. Cela voudrait dire que la magnitude et le volume sont des bons prédicteurs pour le type de magma.

Cependant le problème est le suivant, les écarts types sont beaucoup trop petits. Le modèle va donc sur estimé les coefficients des classes qui ne sont pas du tout supperposée. Même si il y a un petit chevauchement, les classes extrêmes sont parfaitement séparés, c'est un cas de sépration quasi-complètes. De plus, un autre facteur qui joue sur ces écart-types est le nombre d'échantillon. Le nombre de volcans dans cette étude n'est pas suffisant pour réaliser un modèle cohérent. 

```{r}
model <- multinom(Volcanoes~ Magnitude , data = df)
model1 <- multinom(Volcanoes~ Magnitude + Depth, data = df)
model2 <- multinom(Volcanoes~ Magnitude + Depth + Volume, data = df)
```
```{r}
summary(model)
```
```{r}
summary(model1)
```
```{r}
summary(model2)
```


# Clustering (je ne sais pas si ça sert à grand chose de le mettre)

Le clustering est une technique d'apprentissage non supervisée qui permet de regrouper des observations similaires en clusters ou groupes. Ici, le clustering K-means est utilisé pour regrouper les volcans en fonction de leurs caractéristiques quantitatives : profondeur, magnitude et volume.

```{r}
df_cluster <- df[, c("Depth", "Magnitude")]
fviz_nbclust(df_cluster, kmeans, method = "wss") +
  theme_minimal() +
  labs(title = "Méthode du coude - détermination du nombre de clusters")

```

```{r}
set.seed(42)  # pour reproductibilité

km <- kmeans(df_cluster, centers = 2, nstart = 25)
#il faut justifier pourquoi 3 ou 4 groupes avec la techniques du coude (c'est le mieux)
# Ajouter le cluster au jeu de données
df$Cluster <- as.factor(km$cluster)
```

```{r}
ggplot(df, aes(x = Magnitude, y = Depth, color = Cluster, size = Volume)) +
  geom_point(alpha = 0.8) +
  theme_minimal() +
  labs(
    title = "Clustering K-means : Volume, Profondeur et Magnitude",
    x = "Magnitude",
    y = "Profondeur"
  ) +
  scale_y_reverse()
```
```{r}
aggregate(df[, c("Volume", "Depth", "Magnitude")], by = list(df$Cluster), mean)
```


```{r}

plot_ly(df, x = ~Volume, y = ~Depth, z = ~Magnitude,
        color = ~Cluster, colors = "Set1",
        type = "scatter3d", mode = "markers") %>%
  layout(title = "Clustering 3D : Volume, Profondeur et Magnitude")

```




