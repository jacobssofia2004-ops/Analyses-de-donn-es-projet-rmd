---
title: "Projet d'analyse de données – Études sur les volcans méditerranéens"
author: |
  <em>Jacobs Sofia & Bauer Julie<br>
  Master STPE/MV – UCA<br>
  Année académique 2025-2026</em>
date: "<span style='float:right;'>25 septembre 2025</span>"
output: 
  html_document:
    toc: yes
    toc_float:  
      collapsed: false     
      smooth_scroll: true  
      position: right     
    number_sections: yes
    css: styles.css

---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,message = FALSE)
```

# Introduction 

Dans le monde, on compte plus de **800 millions** de personnes vivant à proximité d’un volcan dont **200 millions à moins de 30 km d’un volcan actif** (CNRS, 2025). La caractérisation de l’aléa volcanique est donc essentielle pour **la sureté des habitants** en territoires volcaniques. Cela passe notamment par la compréhension de lien divers entre un volcan et **le type de dépôts ou l’intensité éruptive** qu’il produit. Notre étude se concentre sur la région méditerranéenne, en particulier sur **deux édifices grecs** et **quatre édifices italiens**, ces deux pays étant particulièrement connues pour leurs volcanismes très actifs et notamment plusieurs éruptions historiques. Les volcans italiens sont **l’Etna (Sicile, Italie), le Vésuve (Naples, sud de l’Italie), Lipari et Vulcano (Iles Eoliennes, Sicile, Italie). Les volcans grecques sont le Santorin et le Nisyros (Iles Dodecanese, Grèce)**. Ici nous ne nous concentrerons que sur **la période 2015 à 2025**.

Nous avons **les données de magnitudes, types de magma, profondeur du magma, le VEI, la classification et le volume estimé de produits** pour chaque édifice volcanique en plus des coordonnées des éruptions pour chaque édifices.
L’objectif est de comprendre si il existe un **lien entre intensité de l’éruption (magnitude) et l’édifice volcanique** afin de déterminer quelle population s’expose à un **risque** plus important. Il sera aussi particulièrement intéressant de regarder le **lien possible entre volcans et type de magma** car le risques lié à un volcan est en partie du au type de matériaux qu’il produit. Ces résultats pourrait également nous permettre de déterminer si **les populations** d’un volcan en particulier s’exposent à un **risque accrue**. Enfin, d’un point de vus purement recherche nous allons nous intéressé au **lien entre édifice et profondeur du magma** car c’est grâce à la détection du magma en profondeur que l’on peut **anticiper une éruption**. Egalement à **la profondeur en fonction du type de magma** mais cela nous permettra, au terme d’une étude pétrologique ultérieure de prédire des **temps de remonté du magma et des durées pré-éruptifs** afin **d’alerter la population** en cas d’éruption imminente si ce lien existe.

# Analyse exploiratoire des données 

## Chargement et préparation des données

```{r}
packages <- c("dplyr", "ggplot2", "tidyr","performance","car","maps","ggspatial","sf", "prettymapr","rnaturalearth","rnaturalearthdata","viridis","see","patchwork")

installed_packages <- rownames(installed.packages())
to_install <- packages[!(packages %in% installed_packages)]

if (length(to_install) > 0) {
  message("Installation des packages manquants : ", paste(to_install, collapse = ", "))
  install.packages(to_install)
}

invisible(lapply(packages, function(pkg) {
  library(pkg, character.only = TRUE)
  message("→ ", pkg, " chargé avec succès.")
}))

```

```{r}
df <- read.csv("DataR.csv", sep = ";")#importation des données
str(df)
#modification des types de variables 
df [,c(1,2,8,11,12,13,14)]<- lapply(df[,c(1,2,8,11,12,13,14)], as.factor)
df$Volume <- as.numeric(df$Volume)
summary(df)

var_quali <- df[,c("Depth","Magnitude")]
var_quanti <- df[,c("Volcanoes","Mag.Type", "Region","Country")]
```

```{r}
world <- ne_countries(scale = "medium", returnclass = "sf")

# Tracer la carte
ggplot(data = world) +
  geom_sf(fill = "antiquewhite") +
  geom_point(
    data = df,
    aes(x = Longitude, y = Latitude, color = Volcanoes),
    size = 2, alpha = 0.9
  ) +
  coord_sf(xlim = c(12, 30), ylim = c(35, 42), expand = FALSE) +
  theme_minimal() +
  labs(
    title = "Localisation des volcans en Italie du Sud et en Grèce",
    x = "Longitude",
    y = "Latitude",
    color = "Volcan"
  ) +
  theme(panel.background = element_rect(fill = "lightblue"),
        panel.grid = element_line(color = "white"))



```
```{r}
volcanIt <- df[15:36,]
str(volcanIt)
volcanGr <- df[c(1:13,37:47),]
str(volcanGr)
ggplot(data = world) +
  geom_sf(fill = "antiquewhite") +
  geom_point(
    data = volcanIt,
    aes(x = Longitude, y = Latitude, color = Volcanoes),
    size = 2, alpha = 0.9
  ) +
  coord_sf(xlim = c(12, 19), ylim = c(36.5, 41.5), expand = FALSE) +
  theme_minimal() +
  labs(
    title = "Localisation des volcans en Italie du Sud",
    x = "Longitude",
    y = "Latitude",
    color = "Volcan"
  ) +
  theme(panel.background = element_rect(fill = "lightblue"),
        panel.grid = element_line(color = "white"))

```

```{r}
ggplot(data = world) +
  geom_sf(fill = "antiquewhite") +
  geom_point(
    data = volcanGr,
    aes(x = Longitude, y = Latitude, color = Volcanoes),
    size = 2, alpha = 0.9
  ) +
  coord_sf(xlim = c(19, 30), ylim = c(35.5, 39), expand = FALSE) +
  theme_minimal() +
  labs(
    title = "Localisation des volcans de l'Archipelle des Dodecanese",
    x = "Longitude",
    y = "Latitude",
    color = "Volcan"
  ) +
  theme(panel.background = element_rect(fill = "lightblue"),
        panel.grid = element_line(color = "white"))
```


## Calcule des paramètres de dispersions

```{r}
#permet de calculer la variance et la moyenne pour les variables 
calc_variances_by_group <- function(df, group_col = "Group", numeric_vars = NULL) {
  if (is.null(numeric_vars)) {
    numeric_vars <- names(df)[sapply(df, is.numeric)]
  }

  # 1. Calcul global
  global_var <- sapply(df[numeric_vars], var, na.rm = TRUE)
  global_mean <- sapply(df[numeric_vars], mean, na.rm = TRUE)

  global_df <- data.frame(
    Group = "Global",
    Variable = names(global_var),
    Variance = as.numeric(global_var),
    Mean = as.numeric(global_mean),
    stringsAsFactors = FALSE
  )

  # 2. Calcul par groupe
  groups <- unique(df[[group_col]])
  group_list <- lapply(groups, function(g) {
    sub_df <- df[df[[group_col]] == g, numeric_vars, drop = FALSE]
    s_var <- sapply(sub_df, var, na.rm = TRUE)
    s_mean <- sapply(sub_df, mean, na.rm = TRUE)
    data.frame(
      Group = g,
      Variable = names(s_var),
      Variance = as.numeric(s_var),
      Mean = as.numeric(s_mean),
      stringsAsFactors = FALSE
    )
  })
  group_df <- do.call(rbind, group_list)

  # 3. Combiner
  result <- rbind(global_df, group_df)
  rownames(result) <- NULL

  # 4. Supprimer la notation scientifique
  result$Variance <- format(result$Variance, scientific = FALSE, digits = 6)
  result$Mean <- format(result$Mean, scientific = FALSE, digits = 6)

  return(result)
}
calc_variances_by_group(df, group_col = "Volcanoes", numeric_vars = c("Depth", "Magnitude", "Volume"))


```

```{r}
#à quoi ça sert (je ne sais pas), pas vraiment utile 
df_quant <- df[,c("Depth","Magnitude","Volume")]
apply(df_quant,2,sd)
apply(df_quant,2,sd)/apply(df_quant,2,mean)
```
```{r}
library(dplyr)

df %>%
  group_by(Volcanoes) %>%
  summarise(
    mean_mag = mean(Magnitude, na.rm = TRUE),
    sd_mag = sd(Magnitude, na.rm = TRUE),
    min_mag = min(Magnitude, na.rm = TRUE),
    max_mag = max(Magnitude, na.rm = TRUE),
    median_mag = median(Magnitude, na.rm = TRUE)
  )

```

# Graphiques des analyses univariés


```{r}
#library des packages nécessaire 
library(ggplot2)
library(viridis)  # pour une palette de couleurs agréable

```

## Analyse univariée de la profondeur
```{r}

p<- ggplot(df, aes(x = "", y = Depth)) +
  geom_boxplot(outlier.shape = 16, outlier.color = "red", alpha = 0.7) +  # outliers visibles
  stat_summary(fun = mean, geom = "point", shape = 18, size = 3, color = "blue") + # moyenne
  scale_fill_viridis(discrete = TRUE, option = "D") +  # palette harmonieuse
  theme_minimal(base_size = 14) +
  scale_y_log10() +
  labs(
    title = "Distribution des profondeurs pour l'ensemble des volcans",
    x = "",
    y = "Profondeur (log(km)"
  ) +
  theme(
    legend.position = "none",
    axis.text.x = element_text(angle = 45, hjust = 1),  # rotation labels si nécessaire
    plot.title = element_text(face = "bold", size = 16),
    plot.subtitle = element_text(size = 12)
  )
p1 <- ggplot(df,aes(x=Depth))+
  geom_histogram(binwidth = 0.2, fill="lightyellow", color="black", alpha=0.7)+
  geom_density(color = "red", size = 1) +
  theme_minimal()+
  labs(title="Histogramme de la profondeur des magmas ",
       x="Depth",
       y="")+
  theme(plot.title = element_text(hjust = 0.5, face="bold", size=16))
p+p1
```

```{r}
ggplot(df,aes(x=Depth))+
  geom_histogram(binwidth = 0.2, fill="lightyellow", color="black", alpha=0.7)+
  geom_density(color = "red", size = 1) +
  theme_minimal()+
  labs(title="Histogramme de la profondeur des magmas ",
       x="Depth",
       y="")+
  theme(plot.title = element_text(hjust = 0.5, face="bold", size=16))
```
## Analyse univariée de la magnitude
```{r}
ggplot(df,aes(x=Magnitude))+
  geom_histogram(binwidth = 0.2, fill="lightgreen", color="black", alpha=0.7)+
  geom_density(color = "red", size = 1) +
  theme_minimal()+
  labs(title="Histogramme de la magnitude de éruptions ",
       x="Magnitude",
       y="")+
  theme(plot.title = element_text(hjust = 0.5, face="bold", size=16))
```
```{r}
#séparer les deux populations que l'on observe dans le graphique précédent 
df_forte  <- df[df$Magnitude >= 3, ]
df_faible <- df[df$Magnitude < 3, ] # population forte
```

```{r}
ggplot(df, aes(x="", y = Magnitude)) +
  geom_boxplot(outlier.shape = 16, outlier.color = "red", alpha = 0.7) +  # outliers visibles
  stat_summary(fun = mean, geom = "point", shape = 18, size = 3, color = "blue") + # moyenne
  scale_fill_viridis(discrete = TRUE, option = "D") +  # palette harmonieuse
  theme_minimal(base_size = 14) +
  scale_y_log10() +
  labs(
    title = "Distribution des magnitudes pour l'ensemble des volcans",
    x = "",
    y = "Magnitude"
  ) +
  theme(
    legend.position = "none",
    axis.text.x = element_text(angle = 45, hjust = 1),  # rotation labels si nécessaire
    plot.title = element_text(face = "bold", size = 16),
    plot.subtitle = element_text(size = 12))
```


```{r}
ggplot(df_forte,aes(x=Magnitude))+
  geom_histogram(binwidth = 0.2, fill="lightblue", color="black", alpha=0.7)+
  geom_density(color = "red", size = 1) +
  theme_minimal()+
  labs(title="Histogramme de la magnitude des éruptions fortes (>=3) ",
       x="Magnitude",
       y="")+
  theme(plot.title = element_text(hjust = 0.5, face="bold", size=16))
```
```{r}
ggplot(df_faible,aes(x=Magnitude))+
  geom_histogram(binwidth = 0.2, fill="lightblue", color="black", alpha=0.7)+
  theme_minimal()+
  labs(title="Histogramme de la magnitude des éruptions faible (<3) ",
       x="Magnitude",
       y="")+
  theme(plot.title = element_text(hjust = 0.5, face="bold", size=16))
```

## Analyse univariée du type de magma
```{r}
ggplot(df,aes(x=Mag.Type))+
  geom_bar(binwidth = 0.2, fill="lightyellow", color="black", alpha=0.7)+
  theme_minimal()+
  labs(title="Répartition des types de magmas éruptés pour l'ensemble des volcans ",
       x="Type de magma",
       y="Nombre d'observation")+
  theme(plot.title = element_text(hjust = 0.5, face="bold", size=10))
```
```{r}
ggplot(df,aes(x=log(Volume)))+
  geom_histogram(binwidth = 0.2, fill="lightgreen", color="black", alpha=0.7)+
  geom_density(color = "red", linewidth= 1) +
  theme_minimal()+
  labs(title="Histogramme des volumes estimés de éruptions ",
       x="Volume érupté",
       y="")+
  theme(plot.title = element_text(hjust = 0.5, face="bold", size=16))
```

## Analyse univariée du volume estimé

```{r}
ggplot(df, aes(x="", y = Volume)) +
  geom_boxplot(outlier.shape = 16, outlier.color = "red", alpha = 0.7) +  # outliers visibles
  stat_summary(fun = mean, geom = "point", shape = 18, size = 3, color = "blue") + # moyenne
  scale_fill_viridis(discrete = TRUE, option = "D") +  # palette harmonieuse
  theme_minimal(base_size = 14) +
  scale_y_log10() +
  labs(
    title = "Distribution des volumes estimés pour l'ensemble des volcans",
    x = "",
    y = "Volume"
  ) +
  theme(
    legend.position = "none",
    axis.text.x = element_text(angle = 45, hjust = 1),  # rotation labels si nécessaire
    plot.title = element_text(face = "bold", size = 16),
    plot.subtitle = element_text(size = 12))
```

## Analyse univariée du VEI estimé

```{r}
ggplot(df,aes(x=VEI.approximatif))+
  geom_bar(binwidth = 0.2, fill="lightyellow", color="black", alpha=0.7)+
  theme_minimal()+
  labs(title="Répartition des VEI pour l'ensemble des volcans ",
       x="VEI",
       y="Nombre d'observation")+
  theme(plot.title = element_text(hjust = 0.5, face="bold", size=10))
```


# Analyse bivariés

que 2 variables pas 3, faire test de corrélation linéaire dessus


```{r}
#boxplot entre la magnitude et les volcans
ggplot(df, aes(x = Volcanoes, y = Magnitude, fill = Volcanoes)) +
  geom_boxplot(outlier.shape = 16, outlier.color = "red", alpha = 0.7) +  # outliers visibles
  stat_summary(fun = mean, geom = "point", shape = 18, size = 3, color = "blue") + # moyenne
  scale_fill_viridis(discrete = TRUE, option = "D") +  # palette harmonieuse
  theme_minimal(base_size = 14) +
  labs(
    title = "Distribution de la Magnitude par Volcan",
    x = "Volcans",
    y = "Magnitude"
  ) +
  theme(
    legend.position = "none",
    axis.text.x = element_text(angle = 45, hjust = 1),  # rotation labels si nécessaire
    plot.title = element_text(face = "bold", size = 16),
    plot.subtitle = element_text(size = 12))
```


```{r}
#boxplot entre la magnitude et les types de magma
ggplot(df, aes(x = Mag.Type, y = Magnitude, fill = Mag.Type)) +
  geom_boxplot(outlier.shape = 16, outlier.color = "red", alpha = 0.7) +  # outliers visibles
  stat_summary(fun = mean, geom = "point", shape = 18, size = 3, color = "blue") + # moyenne
  scale_fill_viridis(discrete = TRUE, option = "D") +  # palette harmonieuse
  theme_minimal(base_size = 14) +
  labs(
    title = "Distribution de la Magnitude par Type de magma",
    x = "Volcans",
    y = "Magnitude"
  ) +
  theme(
    legend.position = "none",
    axis.text.x = element_text(angle = 45, hjust = 1),  # rotation labels si nécessaire
    plot.title = element_text(face = "bold", size = 16),
    plot.subtitle = element_text(size = 12))
```




```{r}
res <- lm(Magnitude~Depth,data=df)
ggplot(df) +  geom_point(aes(x = Depth, y = Magnitude, color = Volcanoes), size = 3, alpha = 0.5) +
  labs(
    title = "Distribution de la magnitude des volcans en fonction de la profondeur du magma",
    x = "Profondeur (km)",
    y = "Magnitude"
  ) +
  theme_minimal ()

cor.test(df$Depth, df$Magnitude)

```


```{r}

ggplot(df) +  geom_point(aes(x = Magnitude, y = log(Volume)), size = 1) +
  labs(
    title = "Distribution des volumes estimés des volcans en fonction de la magnitude",
    x = "Magnitude",
    y = "Volume"
  ) +
  theme_minimal ()
res <- lm(log(Volume)~Magnitude,data=df)
summary(res)
check_model(res)
```


```{r}
library(car)
leveneTest(Magnitude ~ Mag.Type, data = df)
anova_magma <- aov(Magnitude ~ Mag.Type, data = df)
summary(anova_magma)
TukeyHSD(anova_magma)
```

```{r}
leveneTest(Magnitude ~ Volcanoes, data = df)
anova_volcan <- aov(Magnitude ~ Volcanoes, data = df)
summary(anova_volcan)#pas terrible mais parler avec Julie 
#demander à la prof si on peut faire une ancova  

```






